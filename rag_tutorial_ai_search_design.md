# æ•™ç¨‹AIæœç´¢+é—®ç­”ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

## 1. éœ€æ±‚é‡æ–°ç†è§£

æ ¹æ®ä½ çš„æœ€æ–°åé¦ˆï¼Œä½ éœ€è¦çš„æ˜¯ä¸€ä¸ª**ç»“åˆAIé—®ç­”å’Œä¼ ç»Ÿæœç´¢**çš„ç³»ç»Ÿï¼š
- **æœç´¢åŠŸèƒ½**: ç”¨æˆ·å¯ä»¥é€šè¿‡å…³é”®è¯æœç´¢æ‰¾åˆ°ç›¸å…³æ•™ç¨‹
- **AIé—®ç­”**: ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€æé—®ï¼ŒAIåŸºäºæ•™ç¨‹å†…å®¹ç»™å‡ºç­”æ¡ˆ
- **ç»Ÿä¸€ç•Œé¢**: ä¸€ä¸ªè¾“å…¥æ¡†æ”¯æŒä¸¤ç§æ¨¡å¼ï¼Œæˆ–è€…å¯ä»¥åˆ‡æ¢æ¨¡å¼

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 åŒæ¨¡å¼æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç»Ÿä¸€è¾“å…¥ç•Œé¢                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [æœç´¢/æé—®...]                    [ğŸ”/ğŸ’¬]åˆ‡æ¢ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                                â”‚             â”‚
â”‚           â–¼                                â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   ä¼ ç»Ÿæœç´¢æ¨¡å¼    â”‚              â”‚   AIé—®ç­”æ¨¡å¼     â”‚    â”‚
â”‚  â”‚                 â”‚              â”‚                 â”‚    â”‚
â”‚  â”‚ â€¢ å…³é”®è¯åŒ¹é…     â”‚              â”‚ â€¢ è‡ªç„¶è¯­è¨€ç†è§£   â”‚    â”‚
â”‚  â”‚ â€¢ ç›¸å…³æ€§æ’åº     â”‚              â”‚ â€¢ è¯­ä¹‰æ£€ç´¢       â”‚    â”‚
â”‚  â”‚ â€¢ å¿«é€Ÿè¿”å›ç»“æœ   â”‚              â”‚ â€¢ ç­”æ¡ˆç”Ÿæˆ       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                                â”‚             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                      â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              MiniRAGåŒå¼•æ“ç³»ç»Ÿ                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚  æœç´¢ç´¢å¼•å¼•æ“ â”‚        â”‚  é—®ç­”RAGå¼•æ“  â”‚         â”‚  â”‚
â”‚  â”‚  â”‚              â”‚        â”‚              â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ å€’æ’ç´¢å¼•    â”‚        â”‚ â€¢ å‘é‡ç´¢å¼•    â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ å…³é”®è¯æ£€ç´¢  â”‚        â”‚ â€¢ è¯­ä¹‰æ£€ç´¢    â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ ç›¸å…³æ€§è¯„åˆ†  â”‚        â”‚ â€¢ ä¸Šä¸‹æ–‡ç”Ÿæˆ  â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                   â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚           â–¼                     â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   æœç´¢ç»“æœå±•ç¤º    â”‚   â”‚   é—®ç­”å¯¹è¯å±•ç¤º   â”‚              â”‚
â”‚  â”‚                 â”‚   â”‚                 â”‚              â”‚
â”‚  â”‚ â€¢ æ•™ç¨‹åˆ—è¡¨       â”‚   â”‚ â€¢ å¯¹è¯å¼äº¤äº’     â”‚              â”‚
â”‚  â”‚ â€¢ ç›¸å…³ç‰‡æ®µ       â”‚   â”‚ â€¢ è¯¦ç»†ç­”æ¡ˆ       â”‚              â”‚
â”‚  â”‚ â€¢ å¿«é€Ÿè®¿é—®       â”‚   â”‚ â€¢ å¼•ç”¨æ¥æº       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯å®ç°
- **ç»Ÿä¸€å…¥å£**: ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæ”¯æŒæ¨¡å¼åˆ‡æ¢æˆ–æ™ºèƒ½è¯†åˆ«
- **åŒå¼•æ“**: ä¼ ç»Ÿæœç´¢ç´¢å¼• + RAGé—®ç­”å¼•æ“
- **æ‰‹åŠ¨è·¯ç”±**: ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©æœ€ä½³æ¨¡å¼
- **ç‹¬ç«‹ç»“æœ**: åˆ†åˆ«å±•ç¤ºä¸¤ç§ç»“æœ

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒæ•°æ®è¡¨
```sql
-- æ•™ç¨‹å†…å®¹è¡¨
CREATE TABLE tutorial_contents (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    resource_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    content_text TEXT NOT NULL,        -- æå–çš„çº¯æ–‡æœ¬å†…å®¹
    content_chunks TEXT,               -- JSONæ ¼å¼ï¼Œåˆ†å—ä¿¡æ¯
    file_info TEXT,                    -- JSONæ ¼å¼ï¼Œæ–‡ä»¶å…ƒæ•°æ®
    search_indexed BOOLEAN DEFAULT FALSE,
    rag_indexed BOOLEAN DEFAULT FALSE,
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now')),
    FOREIGN KEY (resource_id) REFERENCES resources(id) ON DELETE CASCADE
);

-- æœç´¢è®°å½•è¡¨
CREATE TABLE search_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    query TEXT NOT NULL,
    query_type TEXT NOT NULL,          -- 'search' æˆ– 'qa'
    user_id INTEGER,
    results_count INTEGER DEFAULT 0,
    response_time REAL,                -- å“åº”æ—¶é—´(ç§’)
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);

-- é—®ç­”ä¼šè¯è¡¨
CREATE TABLE qa_sessions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT NOT NULL,          -- ä¼šè¯æ ‡è¯†
    user_id INTEGER,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    sources TEXT,                      -- JSONæ ¼å¼ï¼Œå¼•ç”¨æ¥æº
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);

-- æ•™ç¨‹è®¿é—®ç»Ÿè®¡
CREATE TABLE tutorial_analytics (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    resource_id INTEGER NOT NULL,
    search_count INTEGER DEFAULT 0,
    qa_count INTEGER DEFAULT 0,
    last_accessed TEXT,
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now')),
    FOREIGN KEY (resource_id) REFERENCES resources(id) ON DELETE CASCADE
);
```

### 3.2 ç´¢å¼•ä¼˜åŒ–
```sql
-- æœç´¢ä¼˜åŒ–
CREATE INDEX idx_tutorial_contents_search ON tutorial_contents(search_indexed);
CREATE INDEX idx_tutorial_contents_rag ON tutorial_contents(rag_indexed);
CREATE INDEX idx_search_records_query ON search_records(query);
CREATE INDEX idx_search_records_type ON search_records(query_type);

-- å…¨æ–‡æœç´¢è™šæ‹Ÿè¡¨
CREATE VIRTUAL TABLE tutorial_fts USING fts5(
    title, 
    content_text,
    content='tutorial_contents',
    content_rowid='id'
);
```

## 4. åŒæ¨¡å¼APIè®¾è®¡

### 4.1 ç»Ÿä¸€æœç´¢/é—®ç­”API
```typescript
// ç»Ÿä¸€æœç´¢æ¥å£
POST /api/tutorials/search-and-ask
{
    query: string;              // ç”¨æˆ·è¾“å…¥
    mode: 'search' | 'qa';      // æ¨¡å¼ï¼Œç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
    limit?: number;             // è¿”å›ç»“æœæ•°é‡
    context?: {                  // é—®ç­”æ¨¡å¼ä¸‹çš„ä¸Šä¸‹æ–‡
        session_id?: string;
        previous_qa?: Array<{q: string, a: string}>;
    };
}

// è¿”å›æ ¼å¼
{
    query_type: 'search' | 'qa';        // å®é™…ä½¿ç”¨çš„æ¨¡å¼
    query_processed: string;            // å¤„ç†åçš„æŸ¥è¯¢
    
    // æœç´¢ç»“æœï¼ˆå¦‚æœæ˜¯æœç´¢æ¨¡å¼ï¼‰
    search_results?: {
        total: number;
        results: Array<{
            resource_id: number;
            title: string;
            excerpt: string;
            relevance_score: number;
            file_type: string;
            resource_slug: string;
            share_url: string;
        }>;
        search_time: number;
    };
    
    // é—®ç­”ç»“æœï¼ˆå¦‚æœæ˜¯é—®ç­”æ¨¡å¼ï¼‰
    qa_result?: {
        answer: string;
        confidence: number;
        sources: Array<{
            resource_id: number;
            title: string;
            excerpt: string;
            relevance_score: number;
        }>;
        session_id: string;
        answer_time: number;
    };
    
    // å»ºè®®ï¼ˆå¯é€‰ï¼‰
    suggestions?: {
        related_queries: string[];
    };
}

// è·å–æœç´¢å»ºè®®
GET /api/tutorials/suggestions?query=å…³é”®è¯
// è¿”å›
{
    suggestions: string[];
    popular_queries: string[];
    auto_complete: string[];
}

// è·å–å†å²è®°å½•
GET /api/tutorials/history
// è¿”å›
{
    recent_searches: Array<{
        query: string;
        type: 'search' | 'qa';
        timestamp: string;
    }>;
    qa_sessions: Array<{
        session_id: string;
        last_question: string;
        timestamp: string;
    }>;
}
```

### 4.2 æ¨¡å¼é€‰æ‹©
ç”¨æˆ·é€šè¿‡ç•Œé¢æ‰‹åŠ¨é€‰æ‹©æœç´¢æˆ–é—®ç­”æ¨¡å¼ï¼Œç³»ç»Ÿä¸å†è‡ªåŠ¨åˆ¤æ–­æŸ¥è¯¢æ¨¡å¼ã€‚

## 5. MiniRAGåŒå¼•æ“é…ç½®

### 5.1 æœç´¢å¼•æ“é…ç½®
```python
# ä¼ ç»Ÿæœç´¢é…ç½®
SEARCH_ENGINE_CONFIG = {
    "type": "traditional",
    "indexing": {
        "method": "inverted_index",
        "tokenizer": "jieba",           # ä¸­æ–‡åˆ†è¯
        "stop_words": ["çš„", "äº†", "åœ¨", "æ˜¯", "æˆ‘"],  # åœç”¨è¯
        "synonyms": {                    # åŒä¹‰è¯
            "æ¨¡ç»„": ["mod", "æ¨¡å—"],
            "å®‰è£…": ["setup", "é…ç½®"]
        }
    },
    "ranking": {
        "algorithm": "bm25",
        "field_weights": {
            "title": 2.0,               # æ ‡é¢˜æƒé‡æ›´é«˜
            "content": 1.0
        }
    }
}
```

### 5.2 é—®ç­”å¼•æ“é…ç½®
```python
# RAGé—®ç­”é…ç½®
QA_ENGINE_CONFIG = {
    "vector_store": {
        "type": "faiss",
        "dimension": 384,
        "index_type": "IndexFlatIP"
    },
    "embedding": {
        "model": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
        "device": "cpu"
    },
    "llm": {
        "type": "openai",              # æˆ–å…¶ä»–LLM
        "model": "gpt-3.5-turbo",
        "temperature": 0.7,
        "max_tokens": 500,
        "system_prompt": "ä½ æ˜¯ä¸€ä¸ªç”œç“œæ¸¸ä¹åœºæ•™ç¨‹åŠ©æ‰‹ï¼ŒåŸºäºæä¾›çš„æ•™ç¨‹å†…å®¹å›ç­”é—®é¢˜ã€‚å›ç­”è¦ç®€æ´æ˜äº†ï¼Œæ­¥éª¤æ¸…æ™°ã€‚"
    },
    "retrieval": {
        "top_k": 5,                    # æ£€ç´¢top5ç›¸å…³ç‰‡æ®µ
        "min_score": 0.7,              # æœ€å°ç›¸å…³æ€§é˜ˆå€¼
        "rerank": True                 # æ˜¯å¦é‡æ’åº
    },
    "generation": {
        "include_sources": True,       # åŒ…å«å¼•ç”¨æ¥æº
        "answer_template": "åŸºäºæ•™ç¨‹å†…å®¹ï¼š{context}\n\nå›ç­”ï¼š{answer}\n\nç›¸å…³æ•™ç¨‹ï¼š{sources}"
    }
}
```

## 6. å‰ç«¯ç•Œé¢è®¾è®¡

### 6.1 ç»Ÿä¸€æœç´¢ç•Œé¢
```vue
<!-- TutorialSearch.vue -->
<template>
  <div class="tutorial-search-container">
    <!-- æœç´¢è¾“å…¥åŒºåŸŸ -->
    <div class="search-input-section">
      <div class="search-box">
        <el-input
          v-model="query"
          :placeholder="currentMode === 'search' ? 'æœç´¢æ•™ç¨‹...' : 'æé—®å…³äºæ•™ç¨‹çš„é—®é¢˜...'"
          size="large"
          @keyup.enter="handleSearch"
          class="search-input"
        >
          <template #prefix>
            <el-icon><Search /></el-icon>
          </template>
          <template #suffix>
            <el-button-group>
              <el-button
                :type="currentMode === 'search' ? 'primary' : 'default'"
                @click="switchMode('search')"
                size="small"
              >
                <el-icon><Document /></el-icon> æœç´¢
              </el-button>
              <el-button
                :type="currentMode === 'qa' ? 'primary' : 'default'"
                @click="switchMode('qa')"
                size="small"
              >
                <el-icon><ChatDotRound /></el-icon> é—®ç­”
              </el-button>
            </el-button-group>
          </template>
        </el-input>
        <el-button
          type="primary"
          size="large"
          @click="handleSearch"
          :loading="loading"
        >
          {{ currentMode === 'search' ? 'æœç´¢' : 'æé—®' }}
        </el-button>
      </div>
      
      <!-- æœç´¢å»ºè®® -->
      <div v-if="suggestions.length > 0" class="search-suggestions">
        <span>å»ºè®®ï¼š</span>
        <el-tag
          v-for="suggestion in suggestions"
          :key="suggestion"
          @click="query = suggestion"
          class="suggestion-tag"
        >
          {{ suggestion }}
        </el-tag>
      </div>
    </div>

    <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
    <div class="results-section" v-if="hasResults">
      <!-- æœç´¢ç»“æœ -->
      <div v-if="result.search_results" class="search-results">
        <div class="results-header">
          æ‰¾åˆ° {{ result.search_results.total }} ä¸ªç›¸å…³æ•™ç¨‹
          <span class="search-time">({{ result.search_results.search_time }}ç§’)</span>
        </div>
        
        <div v-for="item in result.search_results.results" :key="item.resource_id" class="result-card">
          <h3 @click="goToTutorial(item.share_url)" class="result-title">
            <el-icon><Document /></el-icon>
            {{ item.title }}
          </h3>
          <div class="result-meta">
            <el-tag size="small">{{ item.file_type }}</el-tag>
            <span class="relevance-score">ç›¸å…³åº¦: {{ (item.relevance_score * 100).toFixed(1) }}%</span>
          </div>
          <p class="result-excerpt" v-html="highlightKeywords(item.excerpt)"></p>
          <el-button @click="goToTutorial(item.share_url)" text type="primary">
            æŸ¥çœ‹è¯¦ç»†æ•™ç¨‹ â†’
          </el-button>
        </div>
      </div>

      <!-- é—®ç­”ç»“æœ -->
      <div v-if="result.qa_result" class="qa-results">
        <div class="qa-header">
          <el-icon><ChatDotRound /></el-icon>
          æ™ºèƒ½å›ç­”
          <span class="confidence">ç½®ä¿¡åº¦: {{ (result.qa_result.confidence * 100).toFixed(1) }}%</span>
        </div>
        
        <div class="qa-answer">
          <div class="answer-content" v-html="formatAnswer(result.qa_result.answer)"></div>
          
          <div v-if="result.qa_result.sources.length > 0" class="qa-sources">
            <h4>å‚è€ƒæ•™ç¨‹ï¼š</h4>
            <div v-for="source in result.qa_result.sources" :key="source.resource_id" class="source-item">
              <el-link @click="goToTutorial(source.resource_slug)" :underline="false">
                <el-icon><Document /></el-icon>
                {{ source.title }}
              </el-link>
              <span class="source-relevance">ç›¸å…³åº¦: {{ (source.relevance_score * 100).toFixed(1) }}%</span>
            </div>
          </div>
        </div>

        <!-- ç»§ç»­å¯¹è¯ -->
        <div class="qa-continue">
          <el-input
            v-model="followUpQuestion"
            placeholder="ç»§ç»­æé—®..."
            size="small"
            @keyup.enter="continueQA"
          >
            <template #suffix>
              <el-button @click="continueQA" :loading="qaLoading" size="small">
                å‘é€
              </el-button>
            </template>
          </el-input>
        </div>
      </div>

      <!-- ç›¸å…³æŸ¥è¯¢å»ºè®® -->
      <div v-if="result.suggestions?.related_queries.length > 0" class="related-queries">
        <h4>ç›¸å…³æœç´¢ï¼š</h4>
        <el-tag
          v-for="related in result.suggestions.related_queries"
          :key="related"
          @click="query = related; handleSearch()"
          class="related-tag"
        >
          {{ related }}
        </el-tag>
      </div>
    </div>

    <!-- ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€ -->
    <div v-else class="empty-state">
      <div v-if="loading" class="loading-state">
        <el-icon class="is-loading"><Loading /></el-icon>
        <p>{{ currentMode === 'search' ? 'æ­£åœ¨æœç´¢æ•™ç¨‹...' : 'AIæ­£åœ¨æ€è€ƒ...' }}</p>
      </div>
      
      <div v-else-if="!hasSearched" class="welcome-state">
        <el-icon size="48"><Search /></el-icon>
        <h3>ç”œç“œæ¸¸ä¹åœºæ•™ç¨‹æœç´¢</h3>
        <p>è¾“å…¥å…³é”®è¯æœç´¢æ•™ç¨‹ï¼Œæˆ–åˆ‡æ¢åˆ°é—®ç­”æ¨¡å¼å‘AIæé—®</p>
        
        <div class="quick-actions">
          <h4>çƒ­é—¨æœç´¢ï¼š</h4>
          <el-tag
            v-for="popular in popularSearches"
            :key="popular"
            @click="query = popular; handleSearch()"
            class="popular-tag"
          >
            {{ popular }}
          </el-tag>
        </div>
      </div>
      
      <div v-else class="no-results">
        <el-icon size="48"><DocumentDelete /></el-icon>
        <h3>æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</h3>
        <p>è¯•è¯•å…¶ä»–å…³é”®è¯</p>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { 
  Search, Document, ChatDotRound, Loading, DocumentDelete 
} from '@element-plus/icons-vue'

// çŠ¶æ€ç®¡ç†
const query = ref('')
const currentMode = ref<'search' | 'qa'>('search')
const loading = ref(false)
const qaLoading = ref(false)
const hasSearched = ref(false)
const hasResults = computed(() => {
  return !!(result.value.search_results?.results.length || result.value.qa_result)
})

const result = ref({
  query_type: 'search',
  search_results: null,
  qa_result: null,
  suggestions: null
})

const suggestions = ref<string[]>([])
const followUpQuestion = ref('')
const popularSearches = ref(['å®‰è£…æ•™ç¨‹', 'æ¨¡ç»„ä½¿ç”¨', 'æ¸¸æˆé…ç½®', 'å¸¸è§é—®é¢˜'])

// æœç´¢å»ºè®®
const generateSuggestions = () => {
  if (!query.value) return
  
  // åŸºäºè¾“å…¥ç”Ÿæˆå»ºè®®
  const input = query.value.toLowerCase()
  const allSuggestions = [
    'å®‰è£…æ•™ç¨‹', 'æ¨¡ç»„å®‰è£…æ•™ç¨‹', 'æ¸¸æˆå®‰è£…æ­¥éª¤',
    'æ¨¡ç»„ä½¿ç”¨æ•™ç¨‹', 'æ¨¡ç»„é…ç½®æ•™ç¨‹', 'æ¨¡ç»„ç®¡ç†',
    'æ¸¸æˆè®¾ç½®æ•™ç¨‹', 'æ¸¸æˆé…ç½®æŒ‡å—', 'æ€§èƒ½ä¼˜åŒ–',
    'å¸¸è§é—®é¢˜', 'é”™è¯¯è§£å†³', 'æ•…éšœæ’é™¤'
  ]
  
  suggestions.value = allSuggestions.filter(s => 
    s.toLowerCase().includes(input) && s !== input
  ).slice(0, 5)
}

// æœç´¢å¤„ç†
const handleSearch = async () => {
  if (!query.value.trim()) return
  
  loading.value = true
  hasSearched.value = true
  
  try {
    const response = await fetch('/api/tutorials/search-and-ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        query: query.value,
        mode: currentMode.value,
        limit: 10
      })
    })
    
    result.value = await response.json()
    generateSuggestions()
    
  } catch (error) {
    console.error('æœç´¢å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

// æ¨¡å¼åˆ‡æ¢
const switchMode = (mode: 'search' | 'qa') => {
  currentMode.value = mode
  // æ¸…é™¤ä¹‹å‰çš„ç»“æœï¼Œè®©ç”¨æˆ·é‡æ–°è¾“å…¥æŸ¥è¯¢
  result.value = {
    query_type: mode,
    search_results: null,
    qa_result: null,
    suggestions: null
  }
}

// ç»§ç»­é—®ç­”
const continueQA = async () => {
  if (!followUpQuestion.value.trim() || !result.value.qa_result) return
  
  qaLoading.value = true
  try {
    const response = await fetch('/api/tutorials/continue-qa', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        session_id: result.value.qa_result.session_id,
        question: followUpQuestion.value
      })
    })
    
    const newResult = await response.json()
    // æ›´æ–°é—®ç­”ç»“æœ
    result.value.qa_result = newResult.qa_result
    followUpQuestion.value = ''
    
  } catch (error) {
    console.error('ç»§ç»­é—®ç­”å¤±è´¥:', error)
  } finally {
    qaLoading.value = false
  }
}

// å·¥å…·å‡½æ•°
const highlightKeywords = (text: string) => {
  if (!query.value) return text
  const keywords = query.value.split(' ')
  let highlighted = text
  keywords.forEach(keyword => {
    if (keyword.trim()) {
      const regex = new RegExp(`(${keyword})`, 'gi')
      highlighted = highlighted.replace(regex, '<mark>$1</mark>')
    }
  })
  return highlighted
}

const formatAnswer = (answer: string) => {
  // ç®€å•çš„markdownæ ¼å¼è½¬æ¢
  return answer
    .replace(/\n/g, '<br>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
}

const goToTutorial = (url: string) => {
  window.open(url, '_blank')
}
</script>

<style scoped>
.tutorial-search-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.search-input-section {
  margin-bottom: 30px;
}

.search-box {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.search-input {
  flex: 1;
}

.search-suggestions {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.suggestion-tag {
  cursor: pointer;
}

.results-section {
  margin-top: 30px;
}

.mode-switch-hint {
  margin-bottom: 20px;
}

.results-header {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 20px;
  color: var(--el-text-color-primary);
}

.search-time {
  color: var(--el-text-color-secondary);
  font-size: 14px;
}

.result-card {
  background: var(--el-bg-color);
  border: 1px solid var(--el-border-color);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 15px;
  transition: all 0.3s;
}

.result-card:hover {
  box-shadow: var(--el-box-shadow-light);
}

.result-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 18px;
  font-weight: 600;
  color: var(--el-color-primary);
  cursor: pointer;
  margin: 0 0 10px 0;
}

.result-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.relevance-score {
  color: var(--el-color-success);
  font-size: 14px;
}

.result-excerpt {
  color: var(--el-text-color-regular);
  line-height: 1.6;
  margin: 10px 0;
}

.qa-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 20px;
}

.confidence {
  margin-left: auto;
  color: var(--el-text-color-secondary);
  font-size: 14px;
}

.qa-answer {
  background: var(--el-bg-color);
  border: 1px solid var(--el-border-color);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.answer-content {
  line-height: 1.8;
  margin-bottom: 20px;
}

.qa-sources {
  border-top: 1px solid var(--el-border-color);
  padding-top: 15px;
}

.source-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

.source-relevance {
  color: var(--el-text-color-secondary);
  font-size: 12px;
}

.qa-continue {
  margin-top: 20px;
}

.related-queries {
  margin-top: 30px;
}

.related-tag, .popular-tag {
  cursor: pointer;
  margin-right: 8px;
  margin-bottom: 8px;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--el-text-color-secondary);
}

.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.welcome-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.quick-actions {
  margin-top: 30px;
}

.no-results {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

:deep(mark) {
  background-color: var(--el-color-warning-light-7);
  padding: 2px 4px;
  border-radius: 3px;
}
</style>
```

## 7. æ‰‹åŠ¨æ¨¡å¼é€‰æ‹©

ç”¨æˆ·é€šè¿‡ç•Œé¢ä¸Šçš„åˆ‡æ¢æŒ‰é’®æ‰‹åŠ¨é€‰æ‹©æœç´¢æˆ–é—®ç­”æ¨¡å¼ï¼Œç³»ç»Ÿæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„æ¨¡å¼æ‰§è¡Œç›¸åº”çš„åŠŸèƒ½ï¼Œä¸å†è¿›è¡Œè‡ªåŠ¨åˆ¤æ–­ã€‚

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 ç¼“å­˜ç­–ç•¥
```python
# å¤šçº§ç¼“å­˜
CACHE_STRATEGY = {
    "search_cache": {
        "ttl": 300,                    # 5åˆ†é’Ÿ
        "max_size": 1000,              # æœ€å¤§1000æ¡
        "key_pattern": "search:{query_hash}:{mode}"
    },
    "qa_cache": {
        "ttl": 600,                    # 10åˆ†é’Ÿ
        "max_size": 500,
        "key_pattern": "qa:{query_hash}"
    },
    "suggestion_cache": {
        "ttl": 1800,                   # 30åˆ†é’Ÿ
        "max_size": 200,
        "key_pattern": "suggest:{prefix}"
    },
    "index_cache": {
        "ttl": 3600,                   # 1å°æ—¶
        "preload": True                # é¢„åŠ è½½çƒ­é—¨ç´¢å¼•
    }
}
```

### 8.2 å¼‚æ­¥å¤„ç†
```python
# å¼‚æ­¥å¤„ç†æµç¨‹
async def process_tutorial_async(resource_id: int):
    """å¼‚æ­¥å¤„ç†æ•™ç¨‹å†…å®¹"""
    try:
        # 1. æå–æ–‡æœ¬å†…å®¹
        content = await extract_content(resource_id)
        
        # 2. å¹¶è¡Œå¤„ç†æœç´¢å’ŒRAGç´¢å¼•
        search_task = asyncio.create_task(index_for_search(resource_id, content))
        rag_task = asyncio.create_task(index_for_rag(resource_id, content))
        
        # 3. ç­‰å¾…ä¸¤ä¸ªä»»åŠ¡å®Œæˆ
        await asyncio.gather(search_task, rag_task)
        
        # 4. æ›´æ–°çŠ¶æ€
        await update_index_status(resource_id, completed=True)
        
    except Exception as e:
        await update_index_status(resource_id, completed=False, error=str(e))
```

## 9. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 9.1 æ™ºèƒ½æç¤º
- **è‡ªåŠ¨è¡¥å…¨**: åŸºäºå†å²æœç´¢å’Œçƒ­é—¨æŸ¥è¯¢
- **æ‹¼å†™çº é”™**: è‡ªåŠ¨çº æ­£æ‹¼å†™é”™è¯¯
- **åŒä¹‰è¯æ‰©å±•**: è‡ªåŠ¨æ‰©å±•åŒä¹‰è¯
- **ç›¸å…³æ¨è**: åŸºäºå½“å‰æŸ¥è¯¢æ¨èç›¸å…³å†…å®¹

### 9.2 æ¸è¿›å¼å±•ç¤º
```typescript
// æ¸è¿›å¼ç»“æœå±•ç¤º
interface ProgressiveResults {
  stage: 'understanding' | 'searching' | 'generating' | 'complete';
  progress: number;
  partialResults?: {
    searchPreview?: SearchResult[];
    answerPreview?: string;
    sourcesFound?: number;
  };
}
```

### 9.3 ä¸ªæ€§åŒ–ä½“éªŒ
- **æœç´¢å†å²**: ä¿å­˜ä¸ªäººæœç´¢å†å²
- **åå¥½å­¦ä¹ **: å­¦ä¹ ç”¨æˆ·åå¥½ï¼Œä¼˜åŒ–ç»“æœæ’åº
- **æ™ºèƒ½æ¨è**: åŸºäºå†å²è¡Œä¸ºæ¨èç›¸å…³å†…å®¹

## 10. éƒ¨ç½²å’Œç›‘æ§

### 10.1 éƒ¨ç½²ç­–ç•¥
```yaml
# docker-compose.yml
version: '3.8'
services:
  tutorial-search:
    build: .
    environment:
      - SEARCH_ENGINE=enabled
      - QA_ENGINE=enabled
      - CACHE_SIZE=1000
      - ASYNC_WORKERS=4
    volumes:
      - ./data:/app/data
      - ./models:/app/models
    depends_on:
      - redis
      - postgres
  
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
  
  monitoring:
    image: prometheus
    ports:
      - "9090:9090"
```

### 10.2 ç›‘æ§æŒ‡æ ‡
```python
# å…³é”®ç›‘æ§æŒ‡æ ‡
METRICS = {
    "search_latency": Histogram("search_duration_seconds"),
    "qa_latency": Histogram("qa_duration_seconds"),
    "search_success_rate": Counter("search_success_total"),
    "qa_success_rate": Counter("qa_success_total"),
    "cache_hit_rate": Gauge("cache_hit_rate"),
    "user_satisfaction": Gauge("user_satisfaction_score"),
    "index_size": Gauge("tutorial_index_size"),
    "active_users": Gauge("active_users_count")
}
```

è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆæä¾›äº†ä¸€ä¸ª**ç»Ÿä¸€çš„æœç´¢+AIé—®ç­”ç•Œé¢**ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸€ä¸ªè¾“å…¥æ¡†è·å¾—ä¸¤ç§æœåŠ¡ï¼š
- **æœç´¢æ¨¡å¼**: å¿«é€Ÿæ‰¾åˆ°ç›¸å…³æ•™ç¨‹
- **é—®ç­”æ¨¡å¼**: è·å¾—è¯¦ç»†çš„AIè§£ç­”
- **æ™ºèƒ½æ¨¡å¼**: ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹å¼

ç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥æ™ºèƒ½åˆ¤æ–­ä½¿ç”¨å“ªç§æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ï¼Œæä¾›äº†æœ€ä½³çš„ç”¨æˆ·ä½“éªŒã€‚